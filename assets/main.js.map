{"version":3,"sources":["webpack:///webpack/bootstrap 719f2a203b5b5af49bee","webpack:///./modules/log.js","webpack:///./modules/options.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///external \"http\"","webpack:///external \"util\"","webpack:///external \"events\"","webpack:///external \"ytdl-core\"","webpack:///./main.js","webpack:///external \"discord.js\"","webpack:///./modules/musicFromPlugin.js","webpack:///external \"formidable\"","webpack:///../node_modules/is-buffer/index.js","webpack:///./modules/htspDecode.js","webpack:///external \"node-id3\"","webpack:///./modules/musicPlayer.js","webpack:///./modules/UserQueue.js","webpack:///./modules/UserPlayLists.js","webpack:///./modules/api.js","webpack:///external \"express\"","webpack:///external \"socket.io\"","webpack:///external \"request\"","webpack:///external \"externalip\""],"names":["addZero","digits_length","source","text","length","module","exports","msg","d","Date","date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","console","log","fs","require","path","folders","playLists","cache","tmp","defaultOptions","token","prefix","guildId","configFile","join","__dirname","existsSync","writeFileSync","JSON","stringify","process","exit","options","parse","readFileSync","i","folder","mkdirSync","Discord","client","Client","ytdl","http","musicFromPlugin","musicPlayer","init","util","api","bind","externalip","hostIp","reg","err","ip","register","setInterval","messages","splited","content","split","url","splice","reply","botGuildMember","guilds","find","members","user","id","forEach","el","setTimeout","setNickname","param","sendMsg","replyMsg","getUsers","then","queues","map","member","queue","getAll","id2","fileName","voiceConnection","voiceConnections","filter","first","disconnect","voiceChannel","refresh","np","play","catch","name","dispatcher","end","getPlayList","Promise","resolve","users","playList","createMsg","data","count","min","max","voiceChannelID","channel","add","connection","playFile","on","addLocal","indexOf","substr","voiceChannels","channels","findAll","reject","login","formidable","EventEmitter","isBuffer","htmlspecialchars_decode","nodeID3","MusicFromPlugin","_self","createServer","req","res","setHeader","form","IncomingForm","uploadDir","fields","files","kek","userId","inspect","host","headers","origins","origin","userAgent","contentType","cachePath","names","oldName","newName","checkName","rename","renameToMaybeRealName","Object","assign","newSongHandler","error","listen","emit","match","tags","read","artist","title","newNames","regExp","RegExp","replace","obj","isSlowBuffer","_isBuffer","constructor","readFloatLE","slice","string","quoteStyle","optTemp","noquotes","toString","OPTS","concat","ENT_HTML_QUOTE_SINGLE","UserQueue","MusicPlayer","nowPlaying","vol","pause","addFromPlayList","promises","push","resolve2","bot","getThis","song","all","_filterUsers","_checkUsersCount","_getRandomUser","randomUserId","Math","round","random","randomUser","_getAudio","audio","_selectPlayerAndPlay","_playUrl","stream","streamOptions","seek","volume","playStream","_playFile","filePath","player","local","skip","reason","Array","isArray","_updateUsers","_updateQueues","array","haveItems","newState","paused","resume","newValue","setVolume","UserPlayList","toAdd","addTime","now","ret","remove","get","fix","checkFileExist","writeFile","injectAudio","finded","field","_remove","removed","cachedFilePath","unlink","every","ps","readFile","from","randomized","geted","express","app","server","io","request","instance","connections","handleMusicPlayerEvents","sockets","socketCon","uid","socket","onPause","plPromises","allQueues","pls","pl","broadcast","index","ids","c","mp","postData","type","t","hasOwnProperty","body","getInstance"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 719f2a203b5b5af49bee","function addZero(digits_length, source){\r\n    var text = source + '';\r\n    while(text.length < digits_length)\r\n        text = '0' + text;\r\n    return text;\r\n}\r\n\r\nmodule.exports = function (msg) {\r\n\tlet d = new Date()\r\n\tlet date = d.getFullYear() + \"-\" + addZero( 2, (d.getMonth() + 1) ) + \"-\" + addZero( 2, d.getDate() ) + \" \" + d.getHours() + \":\" + addZero( 2, d.getMinutes() ) + \":\" + addZero( 2, d.getSeconds() ) + \":\" + addZero( 3, d.getMilliseconds() )\r\n\tconsole.log(date, msg)\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/log.js","'use strict'\r\n\r\nconst fs = require(\"fs\")\r\nconst path = require('path')\r\n\r\nlet folders = {\r\n\tplayLists: \"playLists/\",\r\n\tcache: \"cache/\",\r\n\ttmp: \"tmp/\"\r\n}\r\n\r\nlet defaultOptions = {\r\n\ttoken: 'app token here',\r\n\tprefix: '!',\r\n\tguildId: \"your server id here\",\r\n\tfolders: folders\r\n}\r\n\r\nlet configFile = path.join(__dirname, \"/config.json\")\r\nif( !fs.existsSync( configFile ) ) {\r\n\tfs.writeFileSync( configFile , JSON.stringify(defaultOptions) )\r\n\tprocess.exit( 0 )\r\n}\r\n\r\nlet options = JSON.parse( fs.readFileSync( configFile ) )\r\n\r\nif (\r\n\toptions.token == \"app token here\" ||\r\n\toptions.token.length != 59 ||\r\n\toptions.guildId == \"your server id here\" ||\r\n\toptions.guildId.length != 18 ||\r\n\ttypeof +options.guildId != 'number'\r\n) {\r\n\tconsole.log(\"invalid config\")\r\n\tprocess.exit( 0 )\r\n}\r\n\r\n/*\r\nlet options = {\r\n\ttoken: \"MzQ1OTA1NzAxNjM5Njg0MTA2.DHCgYA.1SMCcJem_lXdWVuS90LNXFFpznA\",\r\n\tprefix: \"!\",\r\n\tguildId: \"345551217918738432\",\r\n\tfolders: folders\r\n}\r\n*/\r\n\r\nfor (let i in options.folders) {\r\n\tlet folder = path.join(__dirname, folders[i])\r\n\tif( !fs.existsSync( folder ) ) fs.mkdirSync( folder )\r\n}\r\n\r\nmodule.exports = options\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/options.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"ytdl-core\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ytdl-core\"\n// module id = 7\n// module chunks = 0","const Discord = require('discord.js');\r\nconst client = new Discord.Client();\r\nconst fs = require(\"fs\")\r\nconst ytdl = require(\"ytdl-core\")\r\nconst http = require(\"http\")\r\nconst path = require(\"path\")\r\nconst log = require(\"./modules/log.js\")\r\nconst musicFromPlugin = require(\"./modules/musicFromPlugin.js\")\r\nconst options = require(\"./modules/options.js\")\r\nconst musicPlayer = require(\"./modules/musicPlayer.js\")\r\nmusicPlayer.init(client)\r\n\r\nconst util = require('util');\r\nconst api = require(\"./modules/api.js\")\r\n\r\napi.bind(client, musicPlayer)\r\n\r\nconst externalip = require(\"externalip\")\r\n\r\nvar hostIp = \"127.0.0.1\",\r\n\treg = () => {\r\n\t\texternalip((err, ip) => {\r\n\t\t\thostIp = ip\r\n\t\t\tapi.register(ip, options.guildId)\r\n\t\t})\r\n\t}\r\n\r\n\r\nreg()\r\nsetInterval(reg, 60000)\r\n\r\n\r\n\r\n'use strict'\r\n\r\n\r\nvar messages = {\r\n\t'play' : (msg) => {\r\n\t\tlet splited = msg.content.split(\" \")\r\n\t\tlet url = splited.splice(1, splited.length) [0]\r\n\t\t//musicPlayer.addUrl ( msg.member.id, url )\r\n\t},\r\n\t'host' : (msg) => {\r\n\t\tmsg.reply( `hosted on ${hostIp}` )\r\n\t},\r\n\t'stop' : (msg) => {\r\n\r\n\t},\r\n\t'pause' : (msg) => {\r\n\r\n\t},\r\n\t'resume' : (msg) => {\r\n\r\n\t},\r\n\t'volume' : (msg) => {\r\n\r\n\t},\r\n\t'loli' : (msg) => {\r\n\t\tlet botGuildMember = client.guilds.find(\"id\", options.guildId).members.find(\"id\", client.user.id);\r\n\t\t[\"пошёл нахуй :)\", \"Harold\"].forEach((el, id) => {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tbotGuildMember.setNickname(el)\r\n\t\t\t}, id * 1000)\r\n\t\t})\r\n\r\n\t\tmsg.reply( 'https://cdn.discordapp.com/attachments/345930097250926602/351458063125053440/MOvL9CT49ME.png' )\r\n\t},\r\n\t'clear' : (msg) => {\r\n\r\n\t},\r\n\t'queue' : (msg) => {\r\n\t\tlet splited = msg.content.split(\" \")\r\n\t\tlet param = splited.splice(1, 1)\r\n\t\tvar sendMsg = (replyMsg) => {\r\n\t\t\tmsg.reply( replyMsg )\r\n\t\t}\r\n\t\tmusicPlayer.getUsers().then(queues => {\r\n\t\t\tlog(\"[main] get all queues\")\r\n\t\t\tlet replyMsg = \"\\n queues: \\n\";\r\n\t\t\tqueues.map(user => {\r\n\t\t\t\tif (!user) return\r\n\t\t\t\tif (param != 'all' && user.id != msg.member.id) return\r\n\t\t\t\treplyMsg += `${user}:\\n`\r\n\t\t\t\tuser.queue.getAll().forEach((el, id2) => {\r\n\t\t\t\t\tif (!el) return\r\n\t\t\t\t\tlet tmp = `\\t${id2 + 1}.\\t${el.fileName}\\n`\r\n\t\t\t\t\tif (replyMsg.length + tmp.length > 1900) {\r\n\t\t\t\t\t\tsendMsg(replyMsg)\r\n\t\t\t\t\t\treplyMsg = '\\n'\r\n\t\t\t\t\t}\r\n\t\t\t\t\treplyMsg += tmp\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t//log(\"send message: \" + replyMsg)\r\n\t\t\tsendMsg ( replyMsg )\r\n\t\t})\r\n\t},\r\n\t'reconnect' : (msg) => {\r\n\r\n\t},\r\n\t'off' : (msg) => {\r\n\t\tlet voiceConnection = client.voiceConnections.filter((el, id) => id == options.guildId).first()\r\n\t\tif (voiceConnection) voiceConnection.disconnect()\r\n\r\n\t\tlog( \"[main] stoped by \" + msg.member )\r\n\t\tprocess.exit( 0 )\r\n\t},\r\n\t'summon' : (msg) => {\r\n\t\tif (msg.member.voiceChannel) {\r\n\t\t\tmsg.member.voiceChannel.join().then(connection => {\r\n\t\t\t\tlog( '[main] joined' )\r\n\t\t\t\tmusicPlayer.refresh()\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t//let dispatcher = client.voiceConnections.filter((el, id) => id == options.guildId).first().dispatcher\r\n\r\n\t\t\t\t\t\tif (!musicPlayer.np()) musicPlayer.play()\r\n\t\t\t\t\t})\r\n\t\t\t}).catch(console.log)\r\n\t\t}\r\n\t},\r\n\t'np' : (msg) => {\r\n\t\tmsg.reply( musicPlayer.np ? `now playing ${musicPlayer.np.fileName || musicPlayer.np.name}` : 'now not playing' )\r\n\t},\r\n\t'help' : (msg) => {\r\n\r\n\t},\r\n\t'skip' : (msg) => {\r\n\t\tlog(\"[main] skiped by \" + msg.member)\r\n\t\tlet dispatcher = client.voiceConnections.filter((el, id) => id == options.guildId).first().dispatcher\r\n\t\tif (dispatcher) dispatcher.end(\"skip\")\r\n\t},\r\n\t'playlist' : (msg) => {\r\n\t\tvar getPlayList = users => {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\tusers.map(user => {\r\n\t\t\t\t\tif (user.id == msg.member.id) user.queue.playList.getAll().then(resolve)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tvar createMsg = playList => {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\tlet replyMsg = `\\n`\r\n\t\t\t\tplayList.data.map((el, id) => {\r\n\t\t\t\t\tlet tmp = `${id + 1}.\\t ${el.fileName}\\n`\r\n\t\t\t\t\tif (replyMsg.length + tmp.length > 1950) {\r\n\t\t\t\t\t\tsendMsg(replyMsg)\r\n\t\t\t\t\t\treplyMsg = `\\n`\r\n\t\t\t\t\t}\r\n\t\t\t\t\treplyMsg += tmp\r\n\t\t\t\t})\r\n\t\t\t\tresolve(replyMsg)\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tvar sendMsg = (replyMsg) => {\r\n\t\t\tmsg.reply( replyMsg )\r\n\t\t}\r\n\r\n\t\tlog(`[main] ${msg.member} get playList`)\r\n\r\n\t\tmusicPlayer.getUsers()\r\n\t\t\t.then(getPlayList)\r\n\t\t\t.then(createMsg)\r\n\t\t\t.then(sendMsg)\r\n\r\n\t},\r\n\t'add': (msg) => {\r\n\t\tlet splited = msg.content.split(\" \")\r\n\t\tlet count = +( splited.splice(1, 1) )\r\n\t\tlet min = 0, max = 50\r\n\t\tif (count > min && count <= max) {\r\n\t\t\tlet voiceConnection = client.voiceConnections.filter((el, id) => id == options.guildId).first()\r\n\t\t\tif (msg.member.voiceChannelID && voiceConnection.channel.id == msg.member.voiceChannelID) {\r\n\t\t\t\tmusicPlayer.add(msg.member, count)\r\n\t\t\t} else {\r\n\t\t\t\tmsg.reply(`зайди ко мне в канал`)\r\n\t\t\t}\r\n\t\t} else msg.reply(`incorrect input! min: ${min}, max: ${max}`)\r\n\t},\r\n\r\n\t//debug\r\n\r\n\t'debug2' : (msg) => {\r\n\t\tmusicPlayer.play()\r\n\t},\r\n\t'debug1' : (msg) => {\r\n\t\tmsg.member.voiceChannel.join()\r\n\t\t\t.then(connection => {\r\n\t\t\t\tconnection.playFile(`C:/test.mp3`)\r\n\t\t\t})\r\n\t}\r\n}\r\n\r\nmusicFromPlugin.on(\"song\", data => {\r\n\tmusicPlayer.addLocal(data)\r\n})\r\n\r\nclient.on(\"message\", (msg) => {\r\n\tif (msg.content.indexOf(options.prefix) != 0) return\r\n\r\n\tlog( \"[main] get message: \" + msg.content )\r\n\r\n\tlet splited = msg.content.split(\" \")\r\n\r\n\tsplited[0] = splited[0].substr(options.prefix.length, splited[0].length)  // remove prefix\r\n\r\n\tif (messages[ splited[0] ]) messages[ splited[0] ]( msg )\r\n})\r\n\r\nclient.on(\"voiceStateUpdate\", () => {\r\n\tmusicPlayer.refresh()\r\n})\r\n\r\nclient.on(\"ready\", () => {\r\n\tlog( \"[main] Bot connected\" )\r\n\tlet voiceChannels = client.guilds.find(\"id\", options.guildId).channels.findAll(\"type\", \"voice\")\r\n\r\n\tvar join = () => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlog(\"[main] try to join \" + voiceChannels[0])\r\n\t\t\tvoiceChannels[0].join()\r\n\t\t\t\t.then(resolve)\r\n\t\t\t\t.catch(reject)\r\n\t\t})\r\n\t}\r\n\tjoin().then(() => { musicPlayer.play() })\r\n})\r\n\r\n\r\n\r\nclient.login(options.token)\r\n\r\nlog( \"[main] Bot started\" )\r\n\n\n\n// WEBPACK FOOTER //\n// ./main.js","module.exports = require(\"discord.js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"discord.js\"\n// module id = 9\n// module chunks = 0","const log = require(\"./log.js\")\r\nconst http = require('http');\r\nconst formidable = require('formidable');\r\nconst fs = require('fs');\r\nconst util = require('util');\r\nconst EventEmitter = require('events')\r\nconst options = require(\"./options.js\")\r\nconst path = require(\"path\")\r\nconst isBuffer = require('is-buffer')\r\nconst htmlspecialchars_decode = require(\"./htspDecode.js\")\r\nconst nodeID3 = require('node-id3');\r\n\r\nclass MusicFromPlugin extends EventEmitter {\r\n\tconstructor () {\r\n\t\tsuper()\r\n\t\tthis.init()\r\n\t}\r\n\r\n\tinit () {\r\n\t\tvar _self = this\r\n\t\thttp.createServer(function (req, res) {\r\n\t\t\tres.setHeader(\"Access-Control-Allow-Origin\", \"*\")\r\n\t\t\tres.setHeader(\"Access-Control-Allow-Methods\", \"POST\")\r\n\t\t\tres.setHeader(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\")\r\n\r\n\t\t\tlet form = new formidable.IncomingForm()\r\n\r\n\t\t\tform.uploadDir = path.join(__dirname, options.folders.tmp)\r\n\r\n\r\n\t\t\tform.parse(req, function (err, fields, files) {\r\n\t\t\t\tif (!files.kek || !fields.userId) {\r\n\t\t\t\t\tres.end(\"???\")\r\n\r\n\t\t\t\t\tlog(\"[musicFromPlugin] not valid \\n\" +\r\n\t\t\t\t\t\tutil.inspect({\r\n\t\t\t\t\t\t\tfields: fields,\r\n\t\t\t\t\t\t\tfiles: files,\r\n\t\t\t\t\t\t\thost: req.headers.host,\r\n\t\t\t\t\t\t\torigins: req.headers.origin,\r\n\t\t\t\t\t\t\tuserAgent: req.headers['user-agent'],\r\n\t\t\t\t\t\t\tcontentType: req.headers['content-type']\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet cachePath = path.join(__dirname, options.folders.cache, fields.userId)\r\n\r\n\t\t\t\tif (!fs.existsSync(cachePath)) fs.mkdirSync(cachePath)\r\n\r\n\t\t\t\tlet splited = files.kek.path.split(\"\\\\\")\r\n\r\n\t\t\t\tlet names = {\r\n\t\t\t\t\toldName: path.join(__dirname, splited[ splited.length - 2 ], splited[ splited.length - 1 ] ),\r\n\t\t\t\t\tnewName: path.join(cachePath,  _self.checkName(files.kek.name))\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_self.rename(names)\r\n\t\t\t\t\t.then(data => _self.renameToMaybeRealName(data, fields.userId))\r\n\t\t\t\t\t.then(data => new Promise((resolve) => {\r\n\t\t\t\t\t\tres.end(\"kek\")\r\n\t\t\t\t\t\tresolve( Object.assign( { userId: fields.userId }, data ) )\r\n\t\t\t\t\t}))\r\n\t\t\t\t\t.then(data => _self.newSongHandler(data))\r\n\t\t\t\t\t.catch(console.error)\r\n\t\t\t})\r\n\t\t}).listen(80)\r\n\t}\r\n\r\n\tnewSongHandler(data) {\r\n\t\tvar _self = this\r\n\t\tlet splited = data.newName.split(\"\\\\\")\r\n\t\tlet fileName = splited[ splited.length - 1 ]\r\n\t\tlog(`[musicFromPlugin] ready to add song ${fileName} to user ${data.userId}`);\r\n\t\t_self.emit(\"song\", {userId: data.userId, fileName: fileName})\r\n\t}\r\n\r\n\trename (names) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlog(`[musicFromPlugin]\\n\\trename: \\t${names.oldName} \\n\\tto: \\t\\t${names.newName}`)\r\n\t\t\tfs.rename(names.oldName, names.newName, (err) => {\r\n\t\t\t\tif (err) reject (err)\r\n\t\t\t\tresolve (names)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\trenameToMaybeRealName (names, userId) {\r\n\t\tvar _self = this\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif ( names.newName.match( /[А-Я]/gi ) ) resolve (names)\r\n\t\t\tlog(\"[musicFromPlugin] try to get tags from: \" + names.newName)\r\n\t\t\tlet tags = nodeID3.read(names.newName)\r\n\t\t\tif (tags && tags.artist && tags.title) {\r\n\t\t\t\tlet newNames = {\r\n\t\t\t\t\toldName: names.newName,\r\n\t\t\t\t\tnewName: path.join(__dirname, options.folders.cache, userId, _self.checkName(`/${tags.artist} - ${tags.title}.mp3`))\r\n\t\t\t\t}\r\n\t\t\t\t_self.rename(newNames)\r\n\t\t\t\t\t.then(resolve)\r\n\t\t\t} else resolve (names)\r\n\t\t})\r\n\t}\r\n\r\n\tcheckName (name) {\r\n\t\tlet regExp = new RegExp('[/*?<>|`:\"]', \"g\")\r\n\r\n\t\treturn htmlspecialchars_decode(\tname).split(\"&nbsp;–&nbsp;\").join(\" - \").replace(regExp, '')\r\n\t}\r\n}\r\n\r\nmodule.exports = new MusicFromPlugin()\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/musicFromPlugin.js","module.exports = require(\"formidable\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"formidable\"\n// module id = 11\n// module chunks = 0","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n\n// The _isBuffer check is for Safari 5-7 support, because it's missing\n// Object.prototype.constructor. Remove this eventually\nmodule.exports = function (obj) {\n  return obj != null && (isBuffer(obj) || isSlowBuffer(obj) || !!obj._isBuffer)\n}\n\nfunction isBuffer (obj) {\n  return !!obj.constructor && typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n\n// For Node v0.10 support. Remove this eventually.\nfunction isSlowBuffer (obj) {\n  return typeof obj.readFloatLE === 'function' && typeof obj.slice === 'function' && isBuffer(obj.slice(0, 0))\n}\n\n\n\n// WEBPACK FOOTER //\n// ../node_modules/is-buffer/index.js","module.exports = function htmlspecialchars_decode (string, quoteStyle) { // eslint-disable-line camelcase\r\n  //       discuss at: http://locutus.io/php/htmlspecialchars_decode/\r\n  //      original by: Mirek Slugen\r\n  //      improved by: Kevin van Zonneveld (http://kvz.io)\r\n  //      bugfixed by: Mateusz \"loonquawl\" Zalega\r\n  //      bugfixed by: Onno Marsman (https://twitter.com/onnomarsman)\r\n  //      bugfixed by: Brett Zamir (http://brett-zamir.me)\r\n  //      bugfixed by: Brett Zamir (http://brett-zamir.me)\r\n  //         input by: ReverseSyntax\r\n  //         input by: Slawomir Kaniecki\r\n  //         input by: Scott Cariss\r\n  //         input by: Francois\r\n  //         input by: Ratheous\r\n  //         input by: Mailfaker (http://www.weedem.fr/)\r\n  //       revised by: Kevin van Zonneveld (http://kvz.io)\r\n  // reimplemented by: Brett Zamir (http://brett-zamir.me)\r\n  //        example 1: htmlspecialchars_decode(\"<p>this -&gt; &quot;</p>\", 'ENT_NOQUOTES')\r\n  //        returns 1: '<p>this -> &quot;</p>'\r\n  //        example 2: htmlspecialchars_decode(\"&amp;quot;\")\r\n  //        returns 2: '&quot;'\r\n  var optTemp = 0\r\n  var i = 0\r\n  var noquotes = false\r\n  if (typeof quoteStyle === 'undefined') {\r\n    quoteStyle = 2\r\n  }\r\n  string = string.toString()\r\n    .replace(/&lt;/g, '<')\r\n    .replace(/&gt;/g, '>')\r\n  var OPTS = {\r\n    'ENT_NOQUOTES': 0,\r\n    'ENT_HTML_QUOTE_SINGLE': 1,\r\n    'ENT_HTML_QUOTE_DOUBLE': 2,\r\n    'ENT_COMPAT': 2,\r\n    'ENT_QUOTES': 3,\r\n    'ENT_IGNORE': 4\r\n  }\r\n  if (quoteStyle === 0) {\r\n    noquotes = true\r\n  }\r\n  if (typeof quoteStyle !== 'number') {\r\n    // Allow for a single string or an array of string flags\r\n    quoteStyle = [].concat(quoteStyle)\r\n    for (i = 0; i < quoteStyle.length; i++) {\r\n      // Resolve string input to bitwise e.g. 'PATHINFO_EXTENSION' becomes 4\r\n      if (OPTS[quoteStyle[i]] === 0) {\r\n        noquotes = true\r\n      } else if (OPTS[quoteStyle[i]]) {\r\n        optTemp = optTemp | OPTS[quoteStyle[i]]\r\n      }\r\n    }\r\n    quoteStyle = optTemp\r\n  }\r\n  if (quoteStyle & OPTS.ENT_HTML_QUOTE_SINGLE) {\r\n    // PHP doesn't currently escape if more than one 0, but it should:\r\n    string = string.replace(/&#0*39;/g, \"'\")\r\n    // This would also be useful here, but not a part of PHP:\r\n    // string = string.replace(/&apos;|&#x0*27;/g, \"'\");\r\n  }\r\n  if (!noquotes) {\r\n    string = string.replace(/&quot;/g, '\"')\r\n  }\r\n  // Put this in last place to avoid escape being double-decoded\r\n  string = string.replace(/&amp;/g, '&')\r\n  return string\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/htspDecode.js","module.exports = require(\"node-id3\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-id3\"\n// module id = 14\n// module chunks = 0","const options = require(\"./options.js\")\r\nconst UserQueue = require(\"./UserQueue.js\")\r\nconst log = require(\"./log.js\")\r\nconst path = require(\"path\")\r\nconst fs = require(\"fs\")\r\nconst ytdl = require('ytdl-core');\r\nconst util = require('util');\r\nconst { EventEmitter } = require(\"events\")\r\n\r\nclass MusicPlayer extends EventEmitter {\r\n\tconstructor(){\r\n\t\tsuper();\r\n\t\tthis.users = []\r\n\t\tthis.nowPlaying = false;\r\n\t\tthis.vol = 10\r\n\t\tthis.on(\"playEnd\", () => {\r\n\t\t\tthis.pause = false\r\n\t\t\tthis.emit(\"pauseStateChange\", false)\r\n\t\t\tthis.play()\r\n\t\t})\r\n\t}\r\n\r\n\tinit (client) {\r\n\t\tthis.client = client\r\n\t}\r\n\r\n\tallQueues () {\r\n\t\treturn this.users\r\n\t}\r\n\r\n\tget np () {\r\n\t\treturn this.nowPlaying\r\n\t}\r\n\r\n\tset np (newState) {\r\n\t\tthis.nowPlaying = newState\r\n\t\tthis.emit(\"npChange\", newState)\r\n\t}\r\n\r\n\tget pause() {\r\n\t\tlet voiceConnection = this.client.voiceConnections\r\n\t\t\t.filter((el, id) => id == options.guildId)\r\n\t\t\t.first()\r\n\t\tif (!voiceConnection || !voiceConnection.dispatcher) return false\r\n\t\treturn voiceConnection.dispatcher.paused\r\n\t}\r\n\r\n\tget volume () {\r\n\t\treturn this.vol\r\n\t}\r\n\r\n\tset volume (newValue) {\r\n\t\tthis.emit(\"volumeChange\", newValue)\r\n\t\tthis.vol = newValue\r\n\t\tlet voiceConnection = this.client.voiceConnections\r\n\t\t\t.filter((el, id) => id == options.guildId)\r\n\t\t\t.first()\r\n\t\tif (!voiceConnection || !voiceConnection.dispatcher) return\r\n\t\tvoiceConnection.dispatcher.setVolume(newValue / 100)\r\n\t}\r\n\r\n\tset pause(newState){\r\n\t\tif (newState != this.pause) {\r\n\t\t\tlet voiceConnection = this.client.voiceConnections\r\n\t\t\t\t.filter((el, id) => id == options.guildId)\r\n\t\t\t\t.first()\r\n\r\n\t\t\tif (!voiceConnection || !voiceConnection.dispatcher) return\r\n\t\t\tlet dispatcher = voiceConnection.dispatcher\r\n\r\n\t\t\tif (newState) {\r\n\t\t\t\tdispatcher.pause()\r\n\t\t\t\tlog(`[musicPlayer] paused`)\r\n\t\t\t} else {\r\n\t\t\t\tdispatcher.resume()\r\n\t\t\t\tlog(`[musicPlayer] resumed`)\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit(\"pauseStateChange\", newState)\r\n\t\t}\r\n\t}\r\n\r\n\tadd (member, count) {\r\n\t\tmember = this.users.find(\"id\", member.id || member)\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\tmember.queue.addFromPlayList()\r\n\t\t}\r\n\t}\r\n\r\n\tgetUsers () {\r\n\t\tvar _self = this\r\n\t\tlog(\"[musicPlayer] get users with queues \");\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tlet promises = [];\r\n\t\t\t_self.users.map(user => {\r\n\t\t\t\tpromises.push(new Promise((resolve2) => {\r\n\t\t\t\t\tlog(\"[musicPlayer] checking user \" + user);\r\n\t\t\t\t\tif (!user.user.bot) {\r\n\t\t\t\t\t\t user.queue.getThis().then(song => {\r\n\t\t\t\t\t\t\t //console.log('debug', song)\r\n\t\t\t\t\t\t\t song ? resolve2(user) : resolve2(false)\r\n\t\t\t\t\t\t })\r\n\t\t\t\t\t} else resolve2( false )\r\n\t\t\t\t}))\r\n\t\t\t})\r\n\t\t\tPromise.all(promises).then(resolve)\r\n\t\t})\r\n\t}\r\n\r\n\tplay () {\r\n\t\tvar _self = this\r\n\r\n\t\tvar _filterUsers = users => {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\tresolve( users.filter(el => el ? el : false) )\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tvar _checkUsersCount = users => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tif (users.length) {\r\n\t\t\t\t\tlog(`[musicPlayer] ${users.length} users geted`)\r\n\t\t\t\t\tresolve(users)\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject('no users with songs')\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tvar _getRandomUser = users => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlet randomUserId = Math.round( Math.random() * ( users.length - 1 ) )\r\n\t\t\t\tlet randomUser = users[ randomUserId ]\r\n\t\t\t\tif (!randomUser) reject ('invalid user')\r\n\t\t\t\tlog(`[musicPlayer] selected ${randomUser}`)\r\n\t\t\t\tresolve(randomUser)\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tvar _getAudio = randomUser => {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\trandomUser.queue.getThis()\r\n\t\t\t\t.then(audio => {\r\n\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\tuser: randomUser,\r\n\t\t\t\t\t\taudio: audio\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve(data)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tvar _selectPlayerAndPlay = data => {\r\n\t\t\tlet _playUrl = url => {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t_self.np = data\r\n\t\t\t\t\t_self.pause = false\r\n\r\n\t\t\t\t\tlet stream = ytdl(url, { filter : 'audioonly' });\r\n\r\n\t\t\t\t\tconst streamOptions = { seek: 0, volume: _self.vol / 100 };\r\n\t\t\t\t\tlet dispatcher = _self.client.voiceConnections\r\n\t\t\t\t\t\t.filter((el, id) => id == options.guildId)\r\n\t\t\t\t\t\t.first()\r\n\t\t\t\t\t\t.playStream(stream, streamOptions)\r\n\r\n\t\t\t\t\tdispatcher.on(\"error\", reject)\r\n\r\n\t\t\t\t\tdispatcher.on(\"start\", () => {\r\n\t\t\t\t\t\tlog(`[musicPlayer] start playing stream ${data.fileName}`)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tdispatcher.on(\"end\", () => {\r\n\t\t\t\t\t\tlog(`[musicPlayer] end playing stream ${data.fileName}`)\r\n\t\t\t\t\t\t_self.np = false\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tlet _playFile = data => {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t_self.np = data\r\n\r\n\t\t\t\t\tlet filePath = path.join(__dirname, options.folders.cache, data.userId, data.fileName)\r\n\t\t\t\t\tlet dispatcher = _self.client.voiceConnections\r\n\t\t\t\t\t\t.filter((el, id) => id == options.guildId)\r\n\t\t\t\t\t\t.first()\r\n\t\t\t\t\t\t.playFile(filePath, { volume: _self.vol / 100 })\r\n\r\n\t\t\t\t\tdispatcher.on(\"error\", reject)\r\n\r\n\t\t\t\t\tdispatcher.on(\"start\", () => {\r\n\t\t\t\t\t\tlog(`[musicPlayer] start playing file ${data.fileName}`)\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tdispatcher.on(\"end\", () => {\r\n\t\t\t\t\t\tlog(`[musicPlayer] end playing file ${data.fileName}`)\r\n\t\t\t\t\t\t_self.np = false\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\tlet _play = (audio) => {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t_self.np = data\r\n\t\t\t\t\t_self.pause = false\r\n\r\n\t\t\t\t\tlet voiceConnection = _self.client.voiceConnections\r\n\t\t\t\t\t\t.filter((el, id) => id == options.guildId)\r\n\t\t\t\t\t\t.first()\r\n\r\n\t\t\t\t\tvar dispatcher;\r\n\r\n\t\t\t\t\tif (data.audio.local) {\r\n\t\t\t\t\t\tlet filePath = path.join(__dirname, options.folders.cache, audio.data.userId, audio.data.fileName)\r\n\t\t\t\t\t\tdispatcher = voiceConnection.playFile(filePath, { volume: _self.vol / 100 })\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst streamOptions = { seek: 0, volume: _self.vol / 100 };\r\n\t\t\t\t\t\tlet stream = ytdl(url, { filter : 'audioonly' });\r\n\t\t\t\t\t\tdispatcher = voiceConnection.playStream(stream, streamOptions)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdispatcher.on(\"error\", reject)\r\n\r\n\t\t\t\t\tdispatcher.on(\"start\", () => {\r\n\t\t\t\t\t\tlog(`[musicPlayer] start playing file ${audio.data.fileName}`)\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tdispatcher.on(\"end\", () => {\r\n\t\t\t\t\t\tlog(`[musicPlayer] end playing file ${audio.data.fileName}`)\r\n\t\t\t\t\t\t_self.np = false\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t*/\r\n\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tlog(`[musicPlayer] audio geted ${ data.audio.fileName }`)\r\n\t\t\t\tvar player;\r\n\t\t\t\tif (data.audio.local) {\r\n\t\t\t\t\t// playing from a fule from plugin\r\n\t\t\t\t\tplayer = _playFile\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//playing from url\r\n\t\t\t\t\tplayer = _playUrl\r\n\t\t\t\t}\r\n\t\t\t\tplayer(data.audio)\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t//after playing skip queue and play again\r\n\t\t\t\t\t\tdata.user.queue.skip()\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(reject)\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tlog(`[musicPlayer] waiting for song`)\r\n\t\tif (_self.np) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\t_self.getUsers()\r\n\t\t\t.then(_filterUsers)\r\n\t\t\t.then(_checkUsersCount)\r\n\t\t\t.then(_getRandomUser)\r\n\t\t\t.then(_getAudio)\r\n\t\t\t.then(_selectPlayerAndPlay)\r\n\t\t\t.then(() => {\r\n\t\t\t\tsetTimeout (() => {\r\n\t\t\t\t\t_self.emit(\"playEnd\")\r\n\t\t\t\t}, 1000)\r\n\t\t\t}) // play next\r\n\t\t\t.catch(reason => {\r\n\t\t\t\t//console.trace(reason)\r\n\t\t\t\tlog(`[musicPlayer] not playing because: ${reason}, next try after 5s` )\r\n\t\t\t\tsetTimeout (() => {\r\n\t\t\t\t\t_self.emit(\"playEnd\")\r\n\t\t\t\t}, 5000)\r\n\t\t\t})\r\n\t}\r\n\r\n\taddLocal (data) {\r\n\t\tvar _self = this\r\n\t\tdata.local = true\r\n\t\tif (_self.users && !Array.isArray(_self.users)) {\r\n\t\t\tlet user = _self.users.find(\"id\", data.userId)\r\n\t\t\tif (user) {\r\n\t\t\t\tuser.queue.add(data)\r\n\t\t\t} else {\r\n\t\t\t\tlog(`[musicPlayer] Audio not added, user <@${data.userId}> not in voice channel with bot`)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trefresh () {\r\n\t\tvar _self = this\r\n\r\n\t\tvar _updateUsers = () => {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t_self.client.voiceConnections.map((el, id) => {\r\n\t\t\t\t\tif (id == options.guildId) {\r\n\t\t\t\t\t\t_self.users = el.channel.members\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tlog(\"[musicPlayer] update users\")\r\n\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tvar _updateQueues = () => {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t_self.users.map((user) => {\r\n\t\t\t\t\tif (!user.queue) {\r\n\t\t\t\t\t\tuser.queue = new UserQueue(user)\r\n\r\n\t\t\t\t\t\tuser.queue.on(\"changed\", data => {\r\n\t\t\t\t\t\t\t_self.emit(\"queueChange\", user)\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tuser.queue.playList.on(\"playListChange\", data => {\r\n\t\t\t\t\t\t\t_self.emit(\"playListChange\", user)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tlog(\"[musicPlayer] update queues\")\r\n\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tlog(\"[musicPlayer] refresh\")\r\n\t\t\t_updateUsers()\r\n\t\t\t\t.then(_updateQueues)\r\n\t\t\t\t.then(resolve)\r\n\t\t})\r\n\t}\r\n\r\n\tasync getUsers () {\r\n\t\t//return only users (no bots) with non zero length queue\r\n\t\tlog(\"[musicPlayer] get users with queues \");\r\n\t\tlet users = this.users.array().filter(user => user.queue.haveItems)\r\n\t\treturn users\r\n\t}\r\n}\r\n\r\nmodule.exports = new MusicPlayer()\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/musicPlayer.js","const options = require(\"./options.js\")\r\nconst UserPlayList = require(\"./UserPlayLists.js\")\r\nconst log = require(\"./log.js\")\r\nconst util = require('util');\r\nconst { EventEmitter } = require(\"events\")\r\n\r\nclass UserQueue extends EventEmitter {\r\n\tconstructor (member) {\r\n\t\tsuper()\r\n\t\tthis.member = member\r\n\t\tthis.queue = []\r\n\t\tthis.playList = new UserPlayList(member)\r\n\t\tthis.addFromPlayList()\r\n\t}\r\n\tadd (toAdd) {\r\n\t\ttoAdd.addTime = Date.now()\r\n\t\tthis.queue.push(toAdd)\r\n\t\tthis.playList.add(toAdd)\r\n\t\tthis.emit(\"changed\", this.queue)\r\n\r\n\t\tlog(`[userQueue] ${this.member} added ${toAdd.fileName}`)\r\n\t}\r\n\tremove (id) {\r\n\t\tvar ret = 0\r\n\t\tif (id == \"all\") {\r\n\t\t\tthis.queue = []\r\n\t\t} else {\r\n\t\t\tret = this.queue.splice(id, 1)\r\n\t\t}\r\n\t\tif (!this.queue.length) this.addFromPlayList()\r\n\t\tthis.emit(\"changed\", this.queue)\r\n\t\treturn ret\r\n\t}\r\n\tskip () {\r\n\t\tlog(`[UserQueue] ${this.member} skiped`)\r\n\t\treturn this.remove(0)\r\n\t}\r\n\tgetAll() {\r\n\t\tlog(`[UserQueue] ${this.member} get all`)\r\n\t\treturn this.queue\r\n\t}\r\n\taddFromPlayList () {\r\n\t\tlog(`[UserQueue] ${this.member} add 1 in queue from play list`)\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tthis.playList.get(\"random\").then(random => {\r\n\t\t\t\tthis.queue.push(random)\r\n\t\t\t\tthis.emit(\"changed\", this.queue)\r\n\t\t\t\tresolve(random)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\tfix () {\r\n\t\tthis.queue = this.queue.filter(el => el ? el : false)\r\n\t\tthis.emit(\"changed\", this.queue)\r\n\t}\r\n\tgetThis () {\r\n\t\tvar _self = this\r\n\t\tlog(`[UserQueue] ${_self.member} try to get 1 from queue`)\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif (!_self.queue.length) {\r\n\t\t\t\tlog(`[UserQueue] queue is empty`)\r\n\t\t\t\t_self.addFromPlayList()\r\n\t\t\t\t\t.then(resolve)\r\n\t\t\t} else {\r\n\t\t\t\tlog(`[UserQueue] ${_self.member} get ${_self.queue[0] ? _self.queue[0].fileName : 'void'} from queue`)\r\n\t\t\t\tif (!_self.queue[0]) _self.fix()\r\n\t\t\t\tresolve( _self.queue[0] )\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tget haveItems() {\r\n\t\treturn !!this.queue.length\r\n\t}\r\n}\r\n\r\nmodule.exports = UserQueue\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/UserQueue.js","const path = require(\"path\")\r\nconst options = require(\"./options.js\")\r\nconst fs = require(\"fs\")\r\nconst log = require(\"./log.js\")\r\nconst { EventEmitter } = require(\"events\")\r\n\r\nclass UserPlayList extends EventEmitter {\r\n\tconstructor (member) {\r\n\t\tsuper()\r\n\r\n\t\tthis.member = member\r\n\r\n\t\tthis.fileName = this.member.id + \".json\"\r\n\t\tthis.path = path.join(__dirname, options.folders.playLists) //\r\n\t\tthis.cachePath = path.join(__dirname, options.folders.cache)\r\n\r\n\t\tthis.checkFileExist()\r\n\t\t\t.then(() => log(\"[UserPlayList] \" + this.member + \" file checked\"))\r\n\t}\r\n\r\n\tcheckFileExist () {\r\n\t\tvar _self = this\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tif ( !fs.existsSync( path.join(_self.path, _self.fileName) ) ) {\r\n\t\t\t\tlog(\"[UserPlayList] \" + this.member + \" created file: \" + path.join(_self.path, _self.fileName))\r\n\t\t\t\tfs.writeFile( _self.path + _self.fileName, JSON.stringify( {\r\n\t\t\t\t\t\"data\" : []\r\n\t\t\t\t} ), resolve)\r\n\t\t\t} else {\r\n\t\t\t\tresolve ()\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tadd (toAdd) {\r\n\t\tvar _self = this,\r\n\t\t\tinjectAudio = playList => {\r\n\t\t\t\treturn new Promise ((resolve, reject) => {\r\n\t\t\t\t\tlet finded = playList.data.filter(audio => audio.fileName == toAdd.fileName)\r\n\r\n\t\t\t\t\tif (!finded.length) playList.data.push(toAdd)\r\n\t\t\t\t\tif (finded.length) reject('audio already exist')\r\n\t\t\t\t\tresolve (playList)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\twriteFile = playList => {\r\n\t\t\t\tfs.writeFile( path.join(_self.path, _self.fileName), JSON.stringify( playList ), (err) => {\r\n\t\t\t\t\t_self.cache = playList\r\n\t\t\t\t\t_self.emit(\"playListChange\", playList)\r\n\t\t\t\t\tlog(\"[UserPlayList] \" + this.member + \" added: \" + toAdd.fileName)\r\n\t\t\t\t} )\r\n\t\t\t}\r\n\r\n\t\treturn new Promise ((resolve, reject) => {\r\n\t\t\t_self.getAll()\r\n\t\t\t\t.then(injectAudio)\r\n\t\t\t\t.then(writeFile)\r\n\t\t\t\t.catch(reason => {\r\n\t\t\t\t\tlog(`[UserPlayList] audio not added because: ${reason}`)\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n\tremove (field, content) {\r\n\t\tvar _self = this\r\n\t\treturn new Promise ((resolve, reject) => {\r\n\t\t\t_self.getAll()\r\n\t\t\t\t.then(playList => {\r\n\t\t\t\t\tvar _remove = (id) => {\r\n\t\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\t\tlet removed = playList.data.splice(id, 1)[0]\r\n\t\t\t\t\t\t\tif (!removed) resolve()\r\n\t\t\t\t\t\t\tlet cachedFilePath = path.join(this.cachePath, removed.userId + \"/\", removed.fileName)\r\n\t\t\t\t\t\t\tfs.unlink(cachedFilePath, err => {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\tlog(`[UserPlayList] ${this.member} not removed ${removed.fileName} from cache. ${err}`)\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tlog(`[UserPlayList] ${this.member} removed ${removed.fileName} from cache`)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tlog(`[UserPlayList] ${this.member} removed ${removed.fileName} with id ${field} from playList`)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn new Promise ((resolve) => {\r\n\t\t\t\t\t\tif (Array.isArray(field) && field.every(el => typeof el == 'number')) {\r\n\t\t\t\t\t\t\tlet ps = []\r\n\t\t\t\t\t\t\tfield.map(el => {\r\n\t\t\t\t\t\t\t\tps.push(_remove(el))\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tPromise.all(ps)\r\n\t\t\t\t\t\t\t\t.then(() => resolve(playList))\r\n\t\t\t\t\t\t} else if (typeof field == 'number') {\r\n\t\t\t\t\t\t\t_remove(field)\r\n\t\t\t\t\t\t\t\t.then(() => resolve(playList))\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tplayList.data = playList.data.filter(el => el[ field ] != content)\r\n\t\t\t\t\t\t\tlog(`[UserPlayList] ${this.member} removed all where: field ${field} == ${content}`)\r\n\t\t\t\t\t\t\tresolve(playList)\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t//reject(\"[UserPlayList] remove() invalid arguments\")\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t.then(playList => {\r\n\t\t\t\t\tfs.writeFile( path.join(_self.path, _self.fileName), JSON.stringify( playList ), (err) => {\r\n\t\t\t\t\t\t_self.cache = playList\r\n\t\t\t\t\t\t_self.emit(\"playListChange\", playList)\r\n\t\t\t\t\t} )\r\n\t\t\t\t})\r\n\t\t\t\t.catch(console.error)\r\n\t\t})\r\n\t}\r\n\tgetAll () {\r\n\t\tvar _self = this\r\n\t\treturn new Promise ((resolve, reject) => {\r\n\t\t\tif (_self.cache) {\r\n\t\t\t\tlog(\"[UserPlayList] \" + this.member + \" get all from cache\")\r\n\r\n\t\t\t\tresolve( _self.cache )\r\n\t\t\t} else {\r\n\t\t\t\tfs.readFile( path.join(_self.path, _self.fileName), 'utf8', (err, data) => {\r\n\t\t\t\t\tif (err) reject (err)\r\n\t\t\t\t\tlet playList = JSON.parse( data )\r\n\r\n\t\t\t\t\t_self.cache = playList\r\n\r\n\t\t\t\t\tlog(\"[UserPlayList] \" + this.member + \" get all file content\")\r\n\r\n\t\t\t\t\tresolve ( playList )\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tget (id) {\r\n\t\tlog(`[UserPlayList] ${this.member} get 1 random from playList`)\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tnew Promise((resolve2) => {\r\n\t\t\t\t if (this.cache) {\r\n\t\t\t\t\t resolve2(this.cache)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.getAll()\r\n\t\t\t\t\t\t.then(resolve2)\r\n\t\t\t\t\t\t.catch(() => {\r\n\t\t\t\t\t\t\tlog(`[UserPlayList] ${this.member} error read playList file`)\r\n\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}).then(from => {\r\n\t\t\t\tlog(`[UserPlayList] get from ${this.cache ? 'cache' : 'file'}`)\r\n\t\t\t\tif (from.data.length) {\r\n\t\t\t\t\tif (id == \"random\") {\r\n\t\t\t\t\t\tlet random = Math.round( Math.random() * ( from.data.length - 1 ) )\r\n\t\t\t\t\t\tlet randomized = from.data[ random ]\r\n\r\n\t\t\t\t\t\tlog(`[UserPlayList] ${this.member} get random ${randomized.fileName} with id ${random + 1} of ${from.data.length}`)\r\n\t\t\t\t\t\tresolve(randomized)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet geted = from.data[ id ]\r\n\t\t\t\t\t\tlog(`[UserPlayList] ${this.member} get ${geted.fileName} with id ${id + 1} of ${from.data.length}`)\r\n\t\t\t\t\t\tresolve(geted)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlog(`[UserPlayList] ${this.member} playList is empty`)\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\nmodule.exports = UserPlayList\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/UserPlayLists.js","const express = require('express')\r\nconst app = express()\r\nconst server = require('http').createServer(app);\r\nconst log = require(\"./log.js\")\r\nconst options = require(\"./options.js\")\r\nconst http = require('http')\r\nconst io = require('socket.io')(server)\r\nconst request = require('request')\r\n\r\n'use strict'\r\n\r\nlet api = (function() {\r\n    var instance;\r\n\r\n\tvar connections = [],\r\n\t\tmusicPlayer,\r\n\t\tclient\r\n\r\n\tfunction handleMusicPlayerEvents () {\r\n\t\tmusicPlayer.on(\"npChange\", data => {\r\n\t\t\tio.sockets.emit(\"nowPlayingChange\", data)\r\n\t\t})\r\n\r\n\t\tmusicPlayer.on(\"pauseStateChange\", data => {\r\n\t\t\tio.sockets.emit(\"pauseStateChange\", data)\r\n\t\t})\r\n\r\n\t\tmusicPlayer.on(\"queueChange\", data => {\r\n\t\t\tlet socketCon = connections.filter(el => el.uid == data.id)\r\n\t\t\tif (!socketCon.length) return\r\n\r\n\t\t\tlet socket = socketCon[0].socket\r\n\t\t\tif (socket) {\r\n\t\t\t\tsocket.emit(\"queueChange\", data.queue.getAll())\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tmusicPlayer.on(\"playListChange\", data => {\r\n\t\t\tlet socketCon = connections.filter(el => el.uid == data.id)[0]\r\n\t\t\tif (!socketCon) return\r\n\r\n\t\t\tlet socket = socketCon.socket\r\n\t\t\tif (socket) {\r\n\t\t\t\tdata.queue.playList.getAll().then(playList => {\r\n\t\t\t\t\tsocket.emit(\"playListChange\", playList.data)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tfunction init () {\r\n\t\tio.on(\"connection\", socket => {\r\n\t\t\tlog(`[api] new connection ${socket.id}`)\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsocket.emit(\"getUID\")\r\n\t\t\t}, 300)\r\n\r\n\t\t\tsocket.on('disconnect', data => {\r\n\t\t\t\tlet user = connections.map((el, id) => {\r\n\t\t\t\t\tif (el.socket.id == socket.id) {\r\n\t\t\t\t\t\treturn connections.splice(id, 1)[0]\r\n\t\t\t\t\t}\r\n\t\t\t\t})[0]\r\n\t\t\t\tlog(`[api] <@${user ? user.uid : 'no authorized'}> disconnected ${socket.id}`);\r\n\t\t\t});\r\n\r\n\t\t\tsocket.on(\"UID\", data => {\r\n\t\t\t\tif (connections.filter(el => el.uid == data).length) {\r\n\t\t\t\t\tconnections.map(el => {\r\n\t\t\t\t\t\tel.uid = data\r\n\t\t\t\t\t\tel.socket = socket\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconnections.push({\r\n\t\t\t\t\t\tsocket: socket,\r\n\t\t\t\t\t\tuid: data\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlog(`[api] bind UID ${data} to socket ${socket.id}`)\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"getAll\", data => {\r\n\t\t\t\tlet cache = {\r\n\t\t\t\t\tusers: [],\r\n\t\t\t\t\tnowPlaying: musicPlayer.np,\r\n\t\t\t\t\tonPause: musicPlayer.pause,\r\n\t\t\t\t\tvolume: musicPlayer.volume\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet plPromises = []\r\n\r\n\t\t\t\tmusicPlayer.allQueues().map((user, id) => {\r\n\t\t\t\t\tplPromises.push( user.queue.playList.getAll() )\r\n\t\t\t\t\tcache.users.push({\r\n\t\t\t\t\t\tname: user.name,\r\n\t\t\t\t\t\tid: id,\r\n\t\t\t\t\t\tqueue: user.queue.getAll()\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\r\n\t\t\t\tPromise.all( plPromises ).then(pls => {\r\n\t\t\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t\t\tpls.map((pl, id) => {\r\n\t\t\t\t\t\t\tcache.users[id].playList = pl.data\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t})\r\n\t\t\t\t}).then( () => {\r\n\t\t\t\t\tsocket.emit(\"all\", cache)\r\n\t\t\t\t} )\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"skip\", data => {\r\n\t\t\t\tlog(\"[api] try to skip from \" + data.userId)\r\n\t\t\t\tlet dispatcher = client.voiceConnections.filter((el, id) => id == options.guildId).first().dispatcher\r\n\t\t\t\tif (dispatcher) dispatcher.end(\"skip\")\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"add\", data => {\r\n\t\t\t\tlet min = 0,\r\n\t\t\t\t\tmax = 100\r\n\r\n\t\t\t\tif (data.count > min && data.count <= max) {\r\n\t\t\t\t\tlog(`[api] added ${data.count} random items from playlist to ${data.userId}`)\r\n\t\t\t\t\tmusicPlayer.add(data.userId, data.count)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlog(`[api] not added ${data.count} random items from playlist to ${data.userId}`)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"pauseStateChange\", data => {\r\n\t\t\t\tmusicPlayer.pause = !!data.newState\r\n\t\t\t\tlog(`[api] set pause to ${data.newState} by ${data.userId}`)\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"volumeChanged\", data => {\r\n\t\t\t\tif (data.newValue < 0 || data.newValue > 100) return\r\n\t\t\t\tmusicPlayer.volume = data.newValue\r\n\t\t\t\tsocket.broadcast.emit(\"volumeChange\", data.newValue)\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"clearQueue\", data => {\r\n\t\t\t\tlet user = musicPlayer.allQueues().find(\"id\", data.userId)\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\tlog(`[api] removed all queue for user ${data.userId}`)\r\n\t\t\t\t\tuser.queue.remove(\"all\")\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"removeFromQueue\", data => {\r\n\t\t\t\tlet user = musicPlayer.allQueues().find(\"id\", data.userId)\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\tlog(`[api] removed ${data.index} from queue for user ${data.userId}`)\r\n\t\t\t\t\tuser.queue.remove(data.index)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"removeFromPlayList\", data => {\r\n\t\t\t\tlet user = musicPlayer.allQueues().find(\"id\", data.userId)\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\tlog(`[api] removed ${data.index} from playList for user ${data.userId}`)\r\n\t\t\t\t\tuser.queue.playList.remove(data.index)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"removeSelectedFromPlayList\", data => {\r\n\t\t\t\tlet user = musicPlayer.allQueues().find(\"id\", data.userId)\r\n\t\t\t\tif (user && data.ids) {\r\n\t\t\t\t\tlog(`[api] removed ${data.ids.length} items from playList for user ${data.userId}`)\r\n\t\t\t\t\tuser.queue.playList.remove(data.ids)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"addFromPlayListInQueue\", data => {\r\n\t\t\t\tlet user = musicPlayer.allQueues().find(\"id\", data.userId)\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\tlog(`[api] added ${data.index} from playList in queue for user ${data.userId}`)\r\n\t\t\t\t\tuser.queue.playList.get(data.index)\r\n\t\t\t\t\t\t.then(audio => {\r\n\t\t\t\t\t\t\tuser.queue.add(audio)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tsocket.on(\"addSelectedFromPlaylistInQueue\", data => {\r\n\t\t\t\tlet user = musicPlayer.allQueues().find(\"id\", data.userId)\r\n\t\t\t\tif (user && data.ids) {\r\n\t\t\t\t\tlog(`[api] added ${data.ids.length} items from playList in queue for user ${data.userId}`)\r\n\t\t\t\t\tdata.ids.map(el => {\r\n\t\t\t\t\t\tuser.queue.playList.get(el)\r\n\t\t\t\t\t\t\t.then(audio => {\r\n\t\t\t\t\t\t\t\tuser.queue.add(audio)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t})\r\n\r\n\t\tserver.listen(2303);\r\n\r\n\t\tlog(`[api] init`)\r\n\r\n\t\treturn {\r\n\t\t\tbind: (c, mp) => {\r\n\t\t\t\tclient = c\r\n\t\t\t\tmusicPlayer = mp\r\n\t\t\t\thandleMusicPlayerEvents()\r\n\t\t\t},\r\n\t\t\tregister: (ip, guildId) => {\r\n\t\t\t\tlet postData = {\r\n\t\t\t\t\ttype: \"update\",\r\n\t\t\t\t\tip: ip,\r\n\t\t\t\t\tguildId: guildId\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet url = \"http://pew-pc.com/harold/index.php?\"\r\n\r\n\t\t\t\tfor (var t in postData) {\r\n\t\t\t\t\tif (postData.hasOwnProperty(t)) {\r\n\t\t\t\t\t\turl += `${t}=${postData[t]}&`\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\trequest.get(url, (err, res, body) => {\r\n\t\t\t\t\tif (err || body == 1) {\r\n\t\t\t\t\t\tlog(\"[api] cannot register. \" + err || body)\r\n\t\t\t\t\t} else if (body == \"0\"){\r\n\t\t\t\t\t\tlog(`[api] registred`)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n    return {\r\n        getInstance: function() {\r\n            if (!instance) {\r\n                instance = init()\r\n            }\r\n            return instance\r\n        }\r\n    }\r\n})();\r\n\r\n\r\n\r\nmodule.exports = api.getInstance()\r\n\n\n\n// WEBPACK FOOTER //\n// ./modules/api.js","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"request\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"externalip\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"externalip\"\n// module id = 22\n// module chunks = 0"],"sourceRoot":""}