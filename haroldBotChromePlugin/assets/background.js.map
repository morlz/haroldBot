{"version":3,"sources":["webpack:///webpack/bootstrap b6edb812063dd7b81333","webpack:///./background.js"],"names":["loadedUrl","songNames","serverIp","chrome","storage","sync","get","data","load","url","Promise","resolve","indexOf","push","console","log","req","XMLHttpRequest","open","responseType","onload","status","blob","response","size","toFixed","urlIndex","send","getName","i","reject","fileName","setTimeout","then","catch","flushMemory","length","uploadBlob","formData","FormData","append","getUserId","userId","warn","$","ajax","type","contentType","processData","success","res","clear","error","id","splice","filter","urls","webRequest","onSendHeaders","addListener","onChanged","area","newValue","lastSongName","createdTabIndex","tabs","create","active","tab","index"],"mappings":"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","file":"background.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b6edb812063dd7b81333","var loadedUrl = [],\r\n\tsongNames = [],\n\tserverIp\n\n\nchrome.storage.sync.get([\"serverIp\"], data => {\n\tserverIp = data.serverIp\n})\n\r\nfunction load (url) {\r\n\treturn new Promise((resolve) => {\r\n\t\tif (loadedUrl.indexOf(url) + 1) return\r\n\t\tloadedUrl.push(url)\r\n\r\n\t\tconsole.log(\"catched url: \", url);\r\n\r\n\t\tlet req = new XMLHttpRequest();\r\n\t\treq.open('GET', url, true);\r\n\t\treq.responseType = 'blob';\r\n\r\n\t\treq.onload = function() {\r\n\t\t\tif (this.status === 200) {\r\n\t\t\t\tvar blob = this.response;\r\n\t\t\t\tconsole.log(\"loaded file\", (blob.size / 1024 / 1024).toFixed(2) , \"mb\");\r\n\t\t\t\tresolve({\r\n\t\t\t\t\tblob: blob,\r\n\t\t\t\t\turlIndex: loadedUrl.indexOf(url)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treq.send();\r\n\t})\r\n}\r\n\r\nfunction getName(data, i = 0) {\r\n\tconsole.log(\"try to get name\", songNames, data.urlIndex);\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tif (songNames[data.urlIndex]) {\r\n\t\t\tconsole.log(\"name geted\", songNames[data.urlIndex])\r\n\t\t\tresolve({\r\n\t\t\t\tblob: data.blob,\r\n\t\t\t\tfileName: songNames[data.urlIndex],\r\n\t\t\t\turlIndex: data.urlIndex\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (i < 10) {\r\n\t\t\t\t\tgetName(data, i + 1)\r\n\t\t\t\t\t\t.then(resolve)\r\n\t\t\t\t\t\t.catch(reject)\r\n\t\t\t\t} else reject ()\r\n\t\t\t}, 100)\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction flushMemory() {\r\n\treturn new Promise((resolve) => {\r\n\t\tif (loadedUrl.length != songNames.length) {\r\n\t\t\tconsole.log(\"flushing memory\");\r\n\t\t\tif (!songNames.length || loadedUrl.length) {\r\n\t\t\t\tloadedUrl = []\r\n\t\t\t\tsongNames = []\r\n\t\t\t} else {\r\n\t\t\t\tloadedUrl = [ loadedUrl[loadedUrl.length - 1] ]\r\n\t\t\t\tsongNames = [ songNames[songNames.length - 1] ]\r\n\t\t\t}\r\n\t\t}\r\n\t\tresolve()\r\n\t})\r\n}\r\n\r\nfunction uploadBlob(data){\r\n\tconsole.log(\"try to send data\");\r\n\tvar formData = new FormData()\r\n\tformData.append('kek', data.blob, data.fileName + '.mp3')\r\n\tgetUserId()\r\n\t\t.then(userId => {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\tformData.append('userId', userId)\r\n\t\t\t\tresolve(formData)\r\n\t\t\t})\r\n\t\t})\r\n\t\t.then(formData => {\n\t\t\tif (!serverIp) {\n\t\t\t\tconsole.warn(\"not send, no server ip\")\n\t\t\t\treturn\n\t\t\t}\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: `http://${serverIp}:80/`,\r\n\t\t\t\tdata: formData,\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\tcontentType: false,\r\n\t\t\t\tprocessData: false,\r\n\t\t\t\tsuccess: function (res) {\r\n\t\t\t\t\tclear(data.urlIndex)\r\n\t\t\t\t\tconsole.log(\"sended, server responce:\", res);\r\n\t\t\t\t},\r\n\t\t\t\terror: function (res) {\r\n\t\t\t\t\tclear(data.urlIndex)\r\n\t\t\t\t\tconsole.warn(\"error, server responce:\", res);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t})\r\n}\r\n\r\nfunction clear(id) {\r\n\tloadedUrl.splice(id, 1)\r\n\tsongNames.splice(id, 1)\r\n\tflushMemory()\r\n}\r\n\r\nvar filter = {\r\n\turls: [\"https://*.vk-cdn.net/*\", \"https://*.userapi.com/*/audios/*\", \"https://*.userapi.com/*.mp3?extra=*\"]\r\n}\r\n\r\nchrome.webRequest.onSendHeaders.addListener(data => {\r\n\tload (data.url)\r\n\t\t.then(getName)\r\n\t\t.then(uploadBlob)\r\n\t\t.catch(flushMemory)\r\n}, filter, [\"requestHeaders\"])\r\n\r\nchrome.storage.onChanged.addListener((data, area) => {\n\tif (data.serverIp && data.serverIp.newValue) {\n\t\tserverIp = data.serverIp.newValue\n\t}\n\tif (data.lastSongName && data.lastSongName.newValue) {\n\t\tconsole.log(\"geted song name\", data.lastSongName.newValue);\r\n\t\tsongNames.push(data.lastSongName.newValue)\n\t}\r\n})\r\n\r\n//chrome.webRequest.onHeadersReceived.addListener(, filter, [\"responseHeaders\"])\r\n\r\nvar createdTabIndex = false\r\n\r\nfunction getUserId(){\r\n\treturn new Promise((resolve) => {\r\n\t\tchrome.storage.sync.get([\"userId\"], (data) => {\r\n\t\t\tif (!data.userId) {\r\n\t\t\t\tif (!createdTabIndex) {\r\n\t\t\t\t\tchrome.tabs.create({\r\n\t\t\t\t\t\tactive: true,\r\n\t\t\t\t\t\turl: \"https://discordapp.com/channels/345551217918738432\"\r\n\t\t\t\t\t}, tab => {\r\n\t\t\t\t\t\tconsole.log(\"tab created with id\", tab.index);\r\n\t\t\t\t\t\tcreatedTabIndex = tab.index\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tgetUserId().then(resolve)\r\n\t\t\t\t\t\t}, 1000)\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tgetUserId().then(resolve)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresolve(data.userId)\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n\r\ngetUserId().then(userId => {\r\n\tconsole.log(userId)\r\n})\n\n/*\nclass App {\n\tconstructor(options){\n\t\tvar _self = this\n\n\t\tthis.songNames = []\n\t\tthis.catchedUrls = []\n\t}\n\n\tasync init (data) {\n\t\tif (!data.userId) {\n\t\t\tdata.userId = await this.getUid()\n\t\t}\n\t\tthis.userId = data.userId\n\t\tthis._refreshSocket(data.serverIp)\n\t\treturn console.log(\"init\")\n\t}\n\n\tasync getUid () {\n\t\tvar _self = this\n\t\tif (_self.createdTabIndex) {\n\t\t\tsetTimeout(() => {\n\t\t\t\treturn _self.getUid()\n\t\t\t}, 1000)\n\t\t} else {\n\t\t\t_self._createDiscordTab()\n\t\t}\n\t}\n\n\tasync _createDiscordTab () {\n\t\tvar _self = this\n\t\tchrome.tabs.create({\n\t\t\tactive: true,\n\t\t\turl: \"https://discordapp.com/channels/345551217918738432\"\n\t\t}, tab => {\n\t\t\tconsole.log(\"tab created with id\", tab.index);\n\n\t\t\tcreatedTabIndex = tab.index\n\t\t\tsetTimeout(() => {\n\t\t\t\tgetUserId().then(resolve)\n\t\t\t}, 1000)\n\t\t})\n\t}\n\n\tcatchRequest (data) {\n\n\t}\n\n\tstorageChanged (data, area) {\n\t\tif (data.serverIp && data.serverIp.newValue) {\n\t\t\tthis._refreshSocket(data.serverIp.newValue)\n\t\t}\n\n\t\tif (data.lastSongName && data.lastSongName.newValue) {\n\t\t\tconsole.log(\"geted song name\", data.lastSongName.newValue);\n\t\t\tthis.songNames.push(data.lastSongName.newValue)\n\t\t}\n\t}\n\n\t_refreshSocket (newIp) {\n\t\tif (this.socket) this.socket.disconnect()\n\t\tif (this.ip == newIp) return this.socket\n\n\t\tthis.ip = newIp\n\t\tthis.socket = io(`http://${newIp}:2302/`)\n\n\t\treturn this.socket\n\t}\n}\n\n*/\n\n\n//let filter = {urls: [\"https://*.vk-cdn.net/*\", \"https://*.userapi.com/*/audios/*\", \"https://*.userapi.com/*.mp3?extra=*\"]}\n\n/*\nvar app = new App()\n\n$(async function () {\n\n\n\tchrome.storage.sync.get([\"serverIp\", \"userId\"], app.init)\n\n\tchrome.webRequest.onSendHeaders.addListener(app.catchRequest, filter, [\"requestHeaders\"])\n\tchrome.storage.onChanged.addListener(app.storageChanged)\n})\n*/\n\n\n\n// WEBPACK FOOTER //\n// ./background.js"],"sourceRoot":""}